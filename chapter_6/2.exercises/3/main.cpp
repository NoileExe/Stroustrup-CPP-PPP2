// calculator01.cpp
/*–ù–∞–π–¥–µ–Ω–Ω—ã–µ –∫–æ—Å—è–∫–∏:
	-(2+3)= –≤—ã–¥–∞–µ—Ç –æ—à–∏–±–∫—É, —Ö–æ—Ç—è 1-(2+3)= –∏–ª–∏ -(3)= –Ω–µ –≤—ã–¥–∞—é—Ç
	(1+2)!= –ò–õ–ò (3)! –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç, –≤—ã–¥–∞–µ—Ç –æ—à–∏–±–∫—É #7 */
	
#include <yes_or_no.h>
#include <console_encoding.h>
#include <std_lib_facilities.h>

//------------------------------------------------------------------------------
ConsoleCP cp {};	//–í–∫–ª—é—á–∞–µ—Ç —Ä—É—Å—Å–∫–∏–π –µ—Å–ª–∏ –Ω–µ –≤–∫–ª—é—á–µ–Ω –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞
//------------------------------------------------------------------------------

class Token {
public:
	char kind;		//—á—Ç–æ –∑–∞ —Å–∏–º–≤–æ–ª
	double value;	 //–¥–ª—è —á–∏—Å–µ–ª: –∑–Ω–∞—á–µ–Ω–∏–µ 
	Token(char ch)	//–æ–±—ä–µ–∫—Ç –∫–ª–∞—Å—Å–∞ Token –∏–∑ —Å–∏–º–≤–æ–ª–∞
		:kind(ch), value(0) { }
	Token(char ch, double val)	 //–æ–±—ä–µ–∫—Ç –∫–ª–∞—Å—Å–∞ Token –∏–∑ —Å–∏–º–≤–æ–ª–∞ –∏ —á–∏—Å–ª–∞ double
		:kind(ch), value(val) { }
};

//------------------------------------------------------------------------------

class Token_stream {
public:
	Token_stream();			//—Å–æ–∑–¥–∞—ë–º Token_stream –∫–æ—Ç–æ—Ä—ã–π —á–∏—Ç–∞–µ—Ç –∏–∑ –ø–æ—Ç–æ–∫–∞ –≤–≤–æ–¥–∞ cin
	Token get();			//–ø–æ–ª—É—á–∞–µ–º –æ–±—ä–µ–∫—Ç Token (—á–ª–µ–Ω get() –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –≤ –¥—Ä—É–≥–æ–º –º–µ—Å—Ç–µ)
	void putback(Token t);	//–≤–æ–∑–≤—Ä–∞—Ç Token –æ–±—Ä–∞—Ç–Ω–æ –≤ —Ñ-—Ü–∏—é (–≤ –±—É—Ñ–µ—Ä)
private:
	//bool Token_stream::full{ false };		// is there a Token in the buffer?
	bool full;
	Token buffer;	//–∑–¥–µ—Å—å —Å–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±—ä–µ–∫—Ç –∫–ª–∞—Å—Å–∞ Token, –ø–æ–º–µ—â—ë–Ω–Ω—ã–π –æ–±—Ä–∞—Ç–Ω–æ,
					// –∏—Å–ø–æ–ª—å–∑—É—è putback ()
};

//------------------------------------------------------------------------------

//–ö–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–æ—Å—Ç–æ –¥–µ–ª–∞–µ—Ç –±—É—Ñ–µ—Ä –ø—É—Å—Ç—ã–º –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ:
Token_stream::Token_stream()
:full(false), buffer(0)	//–Ω–µ—Ç –æ–±—ä–µ–∫—Ç–∞ Token –≤ –±—É—Ñ–µ—Ä–µ
{
}

//------------------------------------------------------------------------------

//–ß–ª–µ–Ω putback() –ø–æ–º–µ—â–∞–µ—Ç –∞—Ä–≥—É–º–µ–Ω—Ç –≤ –±—É—Ñ–µ—Ä —Å–≤–æ–µ–π —Ñ-—Ü–∏–∏ Token_stream:
void Token_stream::putback(Token t)
{
	if (Token_stream::full)
		error("–û—à–∏–±–∫–∞ —Ñ-—Ü–∏–∏ putback(): –ø–æ–ø—ã—Ç–∫–∞ –∑–∞–ø–æ–ª–Ω–∏—Ç—å —É–∂–µ –ø–æ–ª–Ω—ã–π –±—É—Ñ–µ—Ä");
	
	Token_stream::buffer = t;	//–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å t –≤ –±—É—Ñ–µ—Ä
	Token_stream::full = true;	//—Ç–µ–ø–µ—Ä—å –±—É—Ñ–µ—Ä –ø–æ–ª–æ–Ω
}

//------------------------------------------------------------------------------

int num_of_symb = 0; //–ß—Ç–æ–±—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø–µ—Ä–≤—ã–π —Å–∏–º–≤–æ–ª –≤ —Å—Ç—Ä–æ–∫–µ –∏–ª–∏ –Ω–µ—Ç
int brace = 0; /*—Ñ–∏–≥—É—Ä–Ω–∞—è —Å–∫–æ–±–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –æ—Ç–ª–∏—á–∏—è –æ—Ç –∫—Ä—É–≥–ª–æ–π
(–µ—Å–ª–∏ —Å–∫–æ–±–∫–∏ –≤ —Å–∫–æ–±–∫–∞—Ö), –ø–æ—Ç–æ–º—É –µ—Å–ª–∏ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –≤ {} –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—ã—Ä–∞–∂–µ–Ω–∏—è –≤ () - –û–®–ò–ë–ö–ê*/

//------------------------------------------------------------------------------

Token Token_stream::get()
{
	if (Token_stream::full) { //–ï—Å–ª–∏ –≤ –±—É—Ñ–µ—Ä–µ —É–∂–µ –∏–º–µ–µ—Ç—Å—è –æ–±—ä–µ–∫—Ç —Ç–∏–ø–∞ Token..
		//..—É–¥–∞–ª—è–µ–º –µ–≥–æ –∏–∑ –±—É—Ñ–µ—Ä–∞ (–ø–æ–º–µ—á–∞–µ–º –±—É—Ñ–µ—Ä –∫–∞–∫ –ø—É—Å—Ç–æ–π, —Ç.–µ. –¥–æ—Å—Ç—É–ø–Ω—ã–π –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏)
		Token_stream::full = false;
		return Token_stream::buffer;
	}

	char ch;
	cin >> ch;	//–∑–∞–º–µ—á–∞–Ω–∏–µ: –æ–ø–µ—Ä–∞—Ç–æ—Ä >> –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –ø—É—Å—Ç—ã–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
				 //(–ø—Ä–æ–±–µ–ª, —Å–∏–º–≤–æ–ª –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏, —Ç–∞–±—É–ª—è—Ü–∏—è –∏ —Ç.–¥.)
	
	if (cin.eof())   throw 99; //–ó–∞–∫—Ä—ã—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É? –î–∞ –∏–ª–∏ –ù–µ—Ç (–¥ / –Ω)

	switch (ch) {
	
		case 'x':  throw 100; //–¥–ª—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –≤—ã—Ö–æ–¥–∞

		case '=':	//–¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—ã—á–∏—Å–ª–µ–Ω–∏–π –∏ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ —ç–∫—Ä–∞–Ω
		case '!':
		case ')': case '}': case '+': case '*': case '/': case '%':
			return Token(ch);		//–≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–∏–º–≤–æ–ª –∫–∞–∫ –µ—Å—Ç—å
		
		case '(': 
			brace = 1; //–ü–æ–∫–∞–∂–µ—Ç —á—Ç–æ –≤–Ω—É—Ç—Ä–∏ {} —Å–∫–æ–±–æ–∫ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –∫—Ä—É–≥–ª—ã–µ
						//–ò–Ω–∞—á–µ –µ—Å–ª–∏ –∫—Ä—É–≥–ª—ã–µ —Å–∫–æ–±–∫–∏ —è–≤–ª—è—é—Ç—Å—è –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏, –ø—Ä–∏ –∑–Ω–∞—á–µ–Ω–∏–∏ 0 - –æ—à–∏–±–∫–∞
			num_of_symb = 0; //–ü–æ—Å–ª–µ —Å–∫–æ–±–∫–∏ –º–æ–∂–µ—Ç –∏–¥—Ç–∏ –æ—Ç—Ä–∏—Ü. —á–∏—Å–ª–æ, –Ω–∞–ø—Ä., "(-1+3)"
							 //–∏ –ø–æ –ª–æ–≥–∏–∫–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã –æ–Ω–æ –¥–æ–ª–∂–Ω–æ "—Å—á–∏—Ç–∞—Ç—å—Å—è" 1—ã–º –≤ —Å—Ç—Ä–æ–∫–µ
			return Token(ch);
		
		case '{':
			brace = 0; //–ü–æ–∫–∞–∂–µ—Ç —á—Ç–æ –≤–Ω—É—Ç—Ä–∏ {} —Å–∫–æ–±–æ–∫ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –∫—Ä—É–≥–ª—ã–µ
			num_of_symb = 0; //–ü–æ—Å–ª–µ —Å–∫–æ–±–∫–∏ –º–æ–∂–µ—Ç –∏–¥—Ç–∏ –æ—Ç—Ä–∏—Ü. —á–∏—Å–ª–æ, –Ω–∞–ø—Ä., "{-1*(2+3)}"
							 //–∏ –ø–æ –ª–æ–≥–∏–∫–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã –æ–Ω–æ –¥–æ–ª–∂–Ω–æ "—Å—á–∏—Ç–∞—Ç—å—Å—è" 1—ã–º –≤ —Å—Ç—Ä–æ–∫–µ
			return Token(ch);
	
		case '-': 
		{
			if ( num_of_symb == 0 ) //–ï—Å–ª–∏ —Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø–µ—Ä–≤–æ–µ —á–∏—Å–ª–æ –≤ –≤—ã—Ä–∞–∂–µ–Ω–∏–∏
			{
				cin.putback(ch);		 //–≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–∏–º–≤–æ–ª –æ–±—Ä–∞—Ç–Ω–æ –≤ –ø–æ—Ç–æ–º –≤–≤–æ–¥–∞
				double val;
				cin >> val;			  //—Å—á–∏—Ç—ã–≤–∞–µ–º —á–∏—Å–ª–æ —Å –ø–ª–∞–≤–∞—é—â–µ–π –ó–ü–¢
				return Token('8', val);   //–ø–æ–º–µ—á–∞–µ–º –æ–±—ä–µ–∫—Ç —Å–∏–º–≤–æ–ª–æ–º '8' –æ–∑–Ω–∞—á–∞—é—â–∏–º "—á–∏—Å–ª–æ"
			}
			else   return Token(ch); //–≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–∏–º–≤–æ–ª –∫–∞–∫ –µ—Å—Ç—å
		}

		case '.':
		case '0': case '1': case '2': case '3': case '4':
		case '5': case '6': case '7': case '8': case '9':
		{
			cin.putback(ch);		 //–≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–∏–º–≤–æ–ª –æ–±—Ä–∞—Ç–Ω–æ –≤ –ø–æ—Ç–æ–º –≤–≤–æ–¥–∞
			num_of_symb = 1; //–ø–æ–º–µ—á–∞–µ–º —á—Ç–æ 1–æ–µ —á–∏—Å–ª–æ –≤ —Å—Ç—Ä–æ–∫–µ —É–∂–µ –∏–º–µ–µ—Ç—Å—è
			double val;
			cin >> val;			  //—Å—á–∏—Ç—ã–≤–∞–µ–º —á–∏—Å–ª–æ —Å –ø–ª–∞–≤–∞—é—â–µ–π –ó–ü–¢
			return Token('8', val);   //–ø–æ–º–µ—á–∞–µ–º –æ–±—ä–µ–∫—Ç —Å–∏–º–≤–æ–ª–æ–º '8' –æ–∑–Ω–∞—á–∞—é—â–∏–º "—á–∏—Å–ª–æ"
		}

		default:
			throw 1; //cerr << "–Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π –≤–≤–æ–¥ (#1)";

	}
}

//------------------------------------------------------------------------------

Token_stream ts; //–æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ä–∞–±–æ—Ç—É —Å —á–ª–µ–Ω–∞–º–∏ —Ñ-—Ü–∏–∏ get() –∏ putback() 

//------------------------------------------------------------------------------

double expression(); //–æ–±—ä—è–≤–ª—è–µ–º, —Ç.–∫. —Ñ-—Ü–∏—è primary() –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å expression()

//------------------------------------------------------------------------------

double fact(double num) //–í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ñ–∞–∫—Ç–æ—Ä–∏–∞–ª–∞. –ù–∞ –≤—Ö–æ–¥ —Ç–æ–ª—å–∫–æ —Ü–µ–ª—ã–µ —á–∏—Å–ª–∞
{
	double answer = 1;
			
	if (num-int(num) == 0) //–ß–∏—Å–ª–æ —Ü–µ–ª–æ–µ?
		for (int i = 1; i <= num; ++i)
			answer *= i;
	else   throw 5;
	//"—Ñ–∞–∫—Ç–æ—Ä–∏–∞–ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç –¶–ï–õ–û–ì–û —á–∏—Å–ª–∞ (#5)"
		
	return answer;
}

//------------------------------------------------------------------------------

//double number0()
//{
	//Token t = ts.get();
	//switch (t.kind) {
//}

//–æ–±—Ä–∞–±–æ—Ç–∫–∞ —á–∏—Å–µ–ª, –¥–≤—É—Ö –≤–∏–¥–æ–≤ —Å–∫–æ–±–æ–∫ –∏ —Ñ–∞–∫—Ç–æ—Ä–∏–∞–ª–∞
double primary()
{
	/*–í—ã—Ä–∞–∂–µ–Ω–∏–µ:
							–¢–µ—Ä–º
							–í—ã—Ä–∞–∂–µ–Ω–∏–µ + –¢–µ—Ä–º
							–í—ã—Ä–∞–∂–µ–Ω–∏–µ - –¢–µ—Ä–º
	  –¢–µ—Ä–º:
							–ü–µ—Ä–≤–∏—á–Ω–æ–µ_–í—ã—Ä–∞–∂–µ–Ω–∏–µ
							–¢–µ—Ä–º * –ü–µ—Ä–≤–∏—á–Ω–æ–µ_–í—ã—Ä–∞–∂–µ–Ω–∏–µ
							–¢–µ—Ä–º / –ü–µ—Ä–≤–∏—á–Ω–æ–µ_–í—ã—Ä–∞–∂–µ–Ω–∏–µ
							–¢–µ—Ä–º % –ü–µ—Ä–≤–∏—á–Ω–æ–µ_–í—ã—Ä–∞–∂–µ–Ω–∏–µ
	  –ü–µ—Ä–≤–∏—á–Ω–æ–µ_–í—ã—Ä–∞–∂–µ–Ω–∏–µ:
							–ß–∏—Å–ª–æ
							–ß–∏—Å–ª–æ !
							( –í—ã—Ä–∞–∂–µ–Ω–∏–µ )
							{( –í—ã—Ä–∞–∂–µ–Ω–∏–µ )}
	  –ß–∏—Å–ª–æ:
							–õ–∏—Ç–µ—Ä–∞–ª_—Å_–ø–ª–∞–≤–∞—é—â–µ–π_—Ç–æ—á–∫–æ–π  */
	
	Token t = ts.get();
	switch (t.kind) {
	
		case '(':	//—Ä–µ–≥—É–ª–∏—Ä—É–µ—Ç –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—é '(' –≤—ã—Ä–∞–∂–µ–Ω–∏–µ ')'
		{
			//brace = 1;
			double d = expression();
			t = ts.get();
		
			if (t.kind != ')')   throw 2;
			//cerr << "–æ–∂–∏–¥–∞–ª–∞—Å—å –∑–∞–∫—Ä—ã–≤–∞—é—â–∞—è —Å–∫–æ–±–∫–∞ - ')' (#2)";
		
			return d;
		}
	
		case '{':	//—Ä–µ–≥—É–ª–∏—Ä—É–µ—Ç –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—é '{' '(' –≤—ã—Ä–∞–∂–µ–Ω–∏–µ ')' '}'
		{
			//brace = 0;
			double d = expression();
			t = ts.get();
					
			if (t.kind != '}')   throw 3;
			//"–æ–∂–∏–¥–∞–ª–∞—Å—å –∑–∞–∫—Ä—ã–≤–∞—é—â–∞—è —Å–∫–æ–±–∫–∞ - '}' (#3)"
			else if (brace == 0)   throw 4; //–ù–µ –±—ã–ª–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –∫—Ä—É–≥–ª—ã—Ö —Å–∫–æ–±–æ–∫, –Ω–∞–ø—Ä., {2+1}
			//"–æ–∂–∏–¥–∞–ª–æ—Å—å –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –≤ '(' –∏ ')' –≤–Ω—É—Ç—Ä–∏ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –≤ '{' –∏ '}' (#4)"
					
			return d;
		}
	
		case '8':			//—Å–∏–º–≤–æ–ª '8' –æ–±–æ–∑–Ω–∞—á–∞–µ—Ç —á—Ç–æ –æ–±—ä–µ–∫—Ç —è–≤–ª—è–µ—Ç—Å—è —á–∏—Å–ª–æ–º
		{
			double d = t.value; //–ø–æ–ª—É—á–∞–µ–º —Å–∞–º–æ —á–∏—Å–ª–æ
			t = ts.get(); //–∑–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ t –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
			
			if (t.kind == '!')
			{
				if (d-int(d) != 0) throw 5; //–µ—Å–ª–∏ –Ω–µ —Ü–µ–ª–æ–µ - —Ñ—É–Ω–∫—Ü–∏—è fact –≤—ã–¥–∞—Å—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ #5
				//else if (d < 0) throw 6;//"—Ñ–∞–∫—Ç–æ—Ä–∏–∞–ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç –ü–û–õ–û–ñ–?–¢–ï–õ–¨–ù–û–ì–û —á–∏—Å–ª–∞ (#6)"
				else if (d < 0) d = - fact(abs(d));
				else if (d == 0) d = 1; //–§–∞–∫—Ç–æ—Ä–∏–∞–ª –Ω—É–ª—è —Ä–∞–≤–µ–Ω –µ–¥–∏–Ω–∏—Ü–µ
				else d = fact(d); //–ò–Ω–∞—á–µ –ø—Ä–æ–±—É–µ–º –≤—ã—á–∏—Å–ª–∏—Ç—å —Ñ–∞–∫—Ç–æ—Ä–∏–∞–ª —á–∏—Å–ª–∞
			}
			else ts.putback(t); //–í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–∏–º–≤–æ–ª –≤ –ø–æ—Ç–æ–∫ —Ç–æ–∫–µ–Ω–æ–≤, –∏–Ω–∞—á–µ –ø–æ—Ç–µ—Ä—è–µ—Ç—Å—è
			
			return d;  //–≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ —á–∏—Å–ª–∞
		}
		
		case '=': //–ü–æ–º–æ–≥–∞–µ—Ç –∏–∑–±–µ–∂–∞—Ç—å –æ—à–∏–±–∫–∏ –µ—Å–ª–∏ –ø–µ—Ä–≤–æ–µ —á–∏—Å–ª–æ –≤ –≤—ã—Ä–∞–∂–µ–Ω–∏–∏ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ
			cin.putback(t.kind);
			return 0;
		
		default:
			throw 7; //cerr << "–æ–∂–∏–¥–∞–ª–æ—Å—å –ø–µ—Ä–≤–∏—á–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ (#7)";
	}
}

//------------------------------------------------------------------------------

//–æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ *, / –∏ %
double term()
{
	double left = primary(); //—Å—á–∏—Ç—ã–≤–∞–µ–º –∏ –≤—ã—á–∏—Å–ª—è–µ–º –ø–µ—Ä–≤–∏—á–Ω–æ–µ_–≤—ã—Ä–∞–∂–µ–Ω–∏–µ
	Token t = ts.get();		//–ø–æ–ª—É—á–∞–µ–º —Å–ª–µ–¥. –æ–±—ä–µ–∫—Ç token –∏–∑ –ø–æ—Ç–æ–∫–∞ token'–æ–≤

	while (true) {
		switch (t.kind) {
		  
			case '*':
				left *= primary(); //–≤—ã—á–∏—Å–ª—è–µ–º –ø–µ—Ä–≤–∏—á–Ω–æ–µ_–≤—ã—Ä–∞–∂–µ–Ω–∏–µ –∏ —É–º–Ω–æ–∂–∞–µ–º
				t = ts.get();
				break;
		
			case '/':
			{
				double d = primary();
				
				if (d == 0)   throw 8; //cerr << "–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –Ω—É–ª—å (#8)";
				
				left /= d; //–≤—ã—á–∏—Å–ª—è–µ–º –ø–µ—Ä–≤–∏—á–Ω–æ–µ_–≤—ã—Ä–∞–∂–µ–Ω–∏–µ –∏ –¥–µ–ª–∏–º
				t = ts.get();
				break;
			}
		
			case '%':
			{
				double d = primary();
				
				if (d == 0)   throw 8;
				//cerr << "–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –Ω—É–ª—å (#8)";
				else if ( (left-int(left) != 0) || (d-int(d) != 0) )   throw 9;
				//–ò–Ω–∞—á–µ –µ—Å–ª–∏ –ª–µ–≤–æ–µ –∏–ª–∏ –ø—Ä–∞–≤–æ–µ —á–∏—Å–ª–æ –≤ –≤—ã—Ä–∞–∂–µ–Ω–∏–∏ A % B - –Ω–µ —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ
				//cerr << "–æ–∂–∏–¥–∞–ª–æ—Å—å —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ –ø—Ä–∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏–∏ –æ—Å—Ç–∞—Ç–∫–∞ –æ—Ç –¥–µ–ª–µ–Ω–∏—è (#9)"
				
				left = int(left) % int(d); //–æ–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–µ—Ä–≤–∏—á–Ω–æ–µ_–≤—ã—Ä–∞–∂–µ–Ω–∏–µ –∏ –≤—ã—á–∏—Å–ª—è–µ–º –æ—Å—Ç–∞—Ç–æ–∫ –æ—Ç–¥–µ–ª–µ–Ω–∏—è
				t = ts.get();
				break;
			}
		
			//case '!': //–ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, —Ç.–∫. –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø—Ä–∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏–∏ 2*3!
			//, –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∫–∞–∫ (2*3)!, –∞ –Ω–µ –∫–∞–∫ 2*(3!)
				//if (left == 0)   left = 1;
				//–§–∞–∫—Ç–æ—Ä–∏–∞–ª –Ω—É–ª—è —Ä–∞–≤–µ–Ω –µ–¥–∏–Ω–∏—Ü–∏–µ
				//else left = fact(left);
				//–ò–Ω–∞—á–µ –ø—Ä–æ–±—É–µ–º –≤—ã—á–∏—Å–ª–∏—Ç—å —Ñ–∞–∫—Ç–æ–∏–∞–ª —á–∏—Å–ª–∞
				//(–µ—Å–ª–∏ –Ω–µ —Ü–µ–ª–æ–µ - —Ñ—É–Ω–∫—Ü–∏—è fact –≤—ã–¥–∞—Å—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ #5)
				
				//t = ts.get();
				//break;
		
		

			default:
				ts.putback(t);	 //–≤–æ–∑–≤—Ä–∞—â–∞–µ–º t –æ–±—Ä–∞—Ç–Ω–æ –≤ –ø–æ—Ç–æ–∫ token'–æ–≤
				return left;
		}
	}
}

//------------------------------------------------------------------------------

//–æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ + –∏ -
double expression()
{
	double left = term();	  //—Å—á–∏—Ç—ã–≤–∞–µ–º –∏ –≤—ã—á–∏—Å–ª—è–µ–º Term
	Token t = ts.get();		//–ø–æ–ª—É—á–∞–µ–º —Å–ª–µ–¥. –æ–±—ä–µ–∫—Ç token –∏–∑ –ø–æ—Ç–æ–∫–∞ token'–æ–≤

	while (true) {
		switch (t.kind) {
			
			case '+':
				left += term();	//–≤—ã—á–∏—Å–ª—è–µ–º Term –∏ –ø—Ä–∏–±–∞–≤–ª—è–µ–º
				t = ts.get();
				break;
				
			case '-':
				left -= term();	//–≤—ã—á–∏—Å–ª—è–µ–º Term –∏ –æ—Ç–Ω–∏–º–∞–µ–º
				t = ts.get();
				break;

			default:
				ts.putback(t);	 //–≤–æ–∑–≤—Ä–∞—â–∞–µ–º t –æ–±—Ä–∞—Ç–Ω–æ –≤ –ø–æ—Ç–æ–∫ token'–æ–≤
				return left;	   //–Ω–∞–∫–æ–Ω–µ—Ü: –±–æ–ª—å—à–µ –Ω–µ—Ç + –∏–ª–∏ -: –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—Ç–≤–µ—Ç
		}
	}
}

//------------------------------------------------------------------------------

int first_or_not = 0; /*–ß—Ç–æ–±—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∫–∞–∫–æ–π —Ä–∞–∑ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ñ-—Ü–∏—è main(),
 —á—Ç–æ–±—ã –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å—Ç–æ–∏—Ç –ª–∏ –≤—ã–≤–æ–¥–∏—Ç—å –±–æ–ª—å—à–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏–ª–∏ –∫–æ—Ä–æ—Ç–∫—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é
 (–ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏ –∏–ª–∏ –ø–æ–ø—ã—Ç–∫–∏ –≤—ã–π—Ç–∏ –∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –≤ –ø—Ä–æ–≥—Ä–∞–º–º—É –ø—É—Ç—ë–º –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–≥–æ 
 –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –≤–æ–ø—Ä–æ—Å –æ–∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã)*/

//------------------------------------------------------------------------------

int main()
{
	while (true) {
		try
		{
			if (first_or_not == 0) //–ï—Å–ª–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∞ —Ç–æ–ª—å–∫–æ –∑–∞–ø—É—â–µ–Ω–Ω–∞
			{
				cout << "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ø—Ä–æ–≥—Ä–∞–º–º—É –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä 2019 –ø–æ –ë—å—è—Ä–Ω–µ –°—Ç—Ä–∞—É—Å—Ç—Ä—É–ø—É.\n\n"
						"–ü–æ—Å–ª–µ –∑–Ω–∞–∫–∞ '>' –≤–≤–æ–¥–∏—Ç–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –≤ —Ñ–æ—Ä–º–µ: –ß–ò–°–õ–û –û–ü–ï–†–ê–¢–û–† –ß–ò–°–õ–û –ó–ù–ê–ö_–†–ê–í–ï–ù–°–¢–í–ê.\n"
						"–î–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤–≤–æ–¥–∞ (–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è) –Ω–∞–∂–º–∏—Ç–µ –∫–ª–∞–≤–∏—à—É ENTER.\n\n"
						"–ü–æ—Å–ª–µ–¥–Ω–∏–π (–∑–Ω–∞–∫ —Ä–∞–≤–µ–Ω—Å—Ç–≤–∞ '=') - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—ã—Ä–∞–∂"
						"–µ–Ω–∏—è –∏ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è. –í–ù–ò–ú–ê–ù–ò–ï! –ï—Å–ª–∏ –≤—ã –Ω–µ –≤–≤–µ–¥—ë—Ç–µ –∑–Ω–∞–∫ "
						"—Ä–∞–≤–µ–Ω—Å—Ç–≤–∞ –≤—ã –Ω–µ –ø–æ–ª—É—á–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏–π.\n\n–ß–∏—Å–ª–∞ –º–æ–≥—É—Ç –±—ã—Ç"
						"—å —Å –ª—é–±—ã–º –∑–Ω–∞–∫–æ–º, —Ü–µ–ª—ã–º–∏ –∏ —Å –¥–µ—Å—è—Ç–∏—á–Ω–æ–π —á–∞—Å—Ç—å—é (–¢–û–ß–ö–ê - –¥–µ—Å—è—Ç–∏—á–Ω—ã–π"
						" —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å).\n\n–î–æ—Å—Ç—É–ø–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏: +, -, *, /, % (–æ—Å—Ç–∞—Ç–æ–∫ –æ—Ç –¥–µ"
						"–ª–µ–Ω–∏—è —Ü–µ–ª—ã—Ö), ( ), {()}, –ß–ò–°–õ–û! (—Ñ–∞–∫—Ç–æ—Ä–∏–∞–ª); x - –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –≤—ã—Ö–æ"
						"–¥–∞\n\n–ü—Ä–∏–º–µ—Ä:\n> 2+(2*2)= "; //–ü–†–ò–í–ï–¢–°–¢–í–ò–ï –ò –ò–ù–°–¢–†–£–ö–¶–ò–ò
				first_or_not = 1;
			}
			else
				cout << "\n–í–≤–æ–¥–∏—Ç–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–µ: –ß–ò–°–õ–û –û–ü–ï–†–ê–¢–û–† –ß–ò–°–õ–û –ó–ù–ê–ö_–†–ê–í–ï–ù–°–¢–í–ê.\n"
						"–î–æ—Å—Ç—É–ø–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏: +, -, *, /, % (–æ—Å—Ç–∞—Ç–æ–∫ –æ—Ç –¥–µ–ª–µ–Ω–∏—è —Ü–µ–ª—ã—Ö), ( ),"
						" {()}, –ß–ò–°–õ–û! (—Ñ–∞–∫—Ç–æ—Ä–∏–∞–ª); x - –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –≤—ã—Ö–æ–¥–∞\n–ü—Ä–∏–º–µ—Ä:\n> 2+(2*2)= "; //–ò–ù–°–¢–†–£–ö–¶–ò–ò

			double val = 0;
			cout << "\n\n> ";
			while (cin) {
				Token t = ts.get();

				if (t.kind == '=')		//–¥–ª—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–π –ø–µ—á–∞—Ç–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º '='
				{
					cout << " = " << val << "\n\n> ";
					num_of_symb = 0;
				}
				else
					ts.putback(t);

				val = expression();
			}
		}
		catch (exception& e) { //–î–ª—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏–π –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –ø—Ä–æ–≥—Ä–∞–º–º–æ–π
			cerr << "error: " << e.what() << '\n';
			
			num_of_symb = 0;
			
			if (Y_or_N("–ó–∞–∫—Ä—ã—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É?"))	return 0; //1
		}
		catch (int a) {
		//–í—Å–µ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ –ò –≤—ã—Ö–æ–¥ —á–µ—Ä–µ–∑ CTRL+Z –∏–ª–∏ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π —á–µ—Ä–µ–∑ –≤–≤–æ–¥ 'x'
			string str;
			getline(cin, str);
			cin.clear();

			if (a < 10)			cerr << "–û—à–∏–±–∫–∞: ";

			if (a == 1)			cerr << "–Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π –≤–≤–æ–¥ (#1)	 ";
			else if (a == 2)	cerr << "–æ–∂–∏–¥–∞–ª–∞—Å—å –∑–∞–∫—Ä—ã–≤–∞—é—â–∞—è —Å–∫–æ–±–∫–∞ - ')' (#2)	 ";
			else if (a == 3)	cerr << "–æ–∂–∏–¥–∞–ª–∞—Å—å –∑–∞–∫—Ä—ã–≤–∞—é—â–∞—è —Å–∫–æ–±–∫–∞ - '}' (#3)	 ";
			else if (a == 4)	cerr << "–æ–∂–∏–¥–∞–ª–æ—Å—å –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –≤ '(' –∏ ')' –≤–Ω—É—Ç—Ä–∏ –≤—ã—Ä–∞–∂–µ–Ω–∏—è"
										<< " –≤ '{' –∏ '}' (#4)	 ";
			else if (a == 5)	cerr << "—Ñ–∞–∫—Ç–æ—Ä–∏–∞–ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç –¶–ï–õ–û–ì–û —á–∏—Å–ª–∞ (#5)	 ";
			else if (a == 6)	cerr << "—Ñ–∞–∫—Ç–æ—Ä–∏–∞–ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç –ü–û–õ–û–ñ–ò–¢–ï–õ–¨–ù–û–ì–û —á–∏—Å–ª–∞ (#6)	 ";
			else if (a == 7)	cerr << "–æ–∂–∏–¥–∞–ª–æ—Å—å –ø–µ—Ä–≤–∏—á–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ (#7)	 ";
			else if (a == 8)	cerr << "–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –Ω—É–ª—å (#8)	 ";
			else if (a == 9)	cerr << "–æ–∂–∏–¥–∞–ª–æ—Å—å —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ –ø—Ä–∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏–∏ –æ—Å—Ç–∞—Ç–∫–∞ –æ—Ç "
										<< "–¥–µ–ª–µ–Ω–∏—è (#9)	 ";
			else if (a == 99)	; //–ï—Å–ª–∏ –≤–≤–µ–¥–µ–Ω–æ CTRL+Z - –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º –∏ –ø—Ä–æ—Å—Ç–æ –∑–∞–¥–∞–µ–º –≤–æ–ø—Ä–æ—Å...
			else if (a == 100)	return 0; //–ï—Å–ª–∏ –Ω–∞–∂–∞—Ç 'x' - –Ω–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π –≤—ã—Ö–æ–¥ –∏–∑ –ø—Ä–æ–≥—Ä–∞–º–º—ã
			
			num_of_symb = 0;
			
			if (Y_or_N("–ó–∞–∫—Ä—ã—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É?"))	return 0; //2
		}
		catch (...) { //–î–ª—è –Ω–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω—ã—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏–π
			cerr << "–£–ø—Å! –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ!\n";
			
			num_of_symb = 0;
			
			if (Y_or_N("–ó–∞–∫—Ä—ã—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É?"))	return 0; //3
		}
	}
}

//------------------------------------------------------------------------------
